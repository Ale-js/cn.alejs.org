/*! Ale.js JavaScript Framework
 * Version: 1.0-Alpha
 * (c) 2018 Dong Yingxuan (Bill Dong) - China
 * Released under the MIT License
 */
(function(g,i){var f={};g.Ale={};Ale.version="1.0-Alpha";if(String.prototype.trim===undefined){String.prototype.trim=function(){return this.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}}Ale.data=function(j,A){if(typeof j==="string"&&typeof A==="object"){var w,u,m,k,v,p,l,n,q,t,y,r,o=i.querySelectorAll(j);for(var s=0;s<o.length;s++){w=o[s];k=w.children;for(var z=0;z<k.length;z++){if(k[z].getAttribute("a-for")!==null){v=k[z].getAttribute("a-for").split("in")[0].trim(),p=k[z].getAttribute("a-for").split("in")[1].trim();if(Array.isArray(A[p])&&A[p].length!==0){l=k[z].innerHTML,n={},q=i.createElement(k[z].tagName.toLowerCase());for(var x=0;x<A[p].length;x++){n[v]=A[p][x];t=i.createElement(k[z].tagName.toLowerCase());t.innerHTML=c(l,n);t=a(t,A[p][x]);q.innerHTML+="<"+k[z].tagName.toLowerCase()+">"+t.innerHTML+"</"+k[z].tagName.toLowerCase()+">"}o[s].innerHTML=q.innerHTML}}}w.innerHTML=c(w.innerHTML,A)}}else{throw"Ale.js: Wrong data type! In function data."}};Ale.define=function(j){if(typeof j==="object"&&!Array.isArray(j)){if(typeof j.name==="string"&&(typeof j.template==="string"||typeof j.template==="function")&&f[j.name]===undefined){if(f[j.name]!==undefined){throw"Ale.js: This component has been defined!"}f[j.name]=j}else{throw"Ale.js: The data type is wrong or the necessary data is missing! In function define."}}else{throw"Ale.js: Wrong data type! In function define."}};Ale.use=function(k){if(typeof k==="object"&&!Array.isArray(k)){if(typeof k.name==="string"&&typeof k.el==="string"&&f[k.name]!==undefined){if(f[k.name]===undefined){throw"Ale.js: This component is undefined!"}var j=f[k.name];j.el=k.el;if(typeof j.life==="object"&&typeof j.life.Using==="function"){j.life.Using()}if(typeof k.data==="object"){for(var l in k.data){j.data[l]=k.data[l]}}if(typeof j.template==="function"){j.templateFn=j.template;j.template=b(j.template,j.data)()}if(typeof k.states==="function"){j.statesFn=k.states;k.states=b(k.states,j.data)()}if(Array.isArray(k.states)){j.states=k.states}else{if(typeof j.states==="function"){j.statesFn=j.states;j.states=b(j.states,j.data)()}}j.events=typeof j.events==="object"?j.events:{};if(typeof j.events==="function"){j.eventsFn=j.events;j.events=b(j.events,j.data)()}if(typeof k.events==="function"){j.eventsFn=k.events;k.events=b(k.events,j.data)()}if(typeof k.events==="object"){for(var l in k.events){j.events[l]=k.events[l]}}if(typeof k.defaultState==="number"){j.defaultState=k.defaultState}return new d(j)}else{throw"Ale.js: The data type is wrong or the necessary data is missing! In function use."}}else{throw"Ale.js: Wrong data type! In function use!"}};function d(m){this.el=i.querySelectorAll(m.el);this.template=m.template;this.data=typeof m.data==="object"?m.data:{};this.states=m.states;this.life=typeof m.life==="object"?m.life:{};this.events=m.events;this.permissions=typeof m.permissions==="object"?m.permissions:{};this.defaultState=typeof m.defaultState==="number"?m.defaultState:0;this.nowState=this.defaultState;this.eventsFn=m.eventsFn;this.statesFn=m.statesFn;this.templateFn=m.templateFn;for(var n=0;n<this.permissionsList.length;n++){if(typeof this.permissions[this.permissionsList[n]]!=="boolean"){this.permissions[this.permissionsList[n]]=true}}this.nextStates=function(q){if(!this.permissions.nextStates){throw"Ale.js: Operations are not allow! (no permission)"}if(!Array.isArray(this.states)){return false}if(typeof q!=="number"){q=1}if(this.states[this.nowState+q]!==undefined){this.nowState+=q;if(typeof this.life.Rendering==="function"){b(this.life.Rendering,this)()}var p=c(this.template,this.states[this.nowState]);for(var r=0;r<this.el.length;r++){this.el[r].innerHTML=p}return true}else{return false}};this.backStates=function(q){if(!this.permissions.backStates){throw"Ale.js: Operations are not allow! (no permission)"}if(!Array.isArray(this.states)){return false}if(typeof q!=="number"){q=1}if(this.states[this.nowState-q]!==undefined){this.nowState-=q;if(typeof this.life.Rendering==="function"){b(this.life.Rendering,this)()}var p=c(this.template,this.states[this.nowState]);for(var r=0;r<this.el.length;r++){this.el[r].innerHTML=p}return true}else{return false}};this.changeState=function(r){if(!this.permissions.changeState){throw"Ale.js: Operations are not allow! (no permission)"}if(typeof r==="object"){var p=c(this.template,r);for(var q=0;q<this.el.length;q++){this.el[q].innerHTML=p}}else{throw"Ale.js: Wrong parameter type! In function changeState."}};this.setStates=function(p){if(!this.permissions.setStates){throw"Ale.js: Operations are not allow! (no permission)"}if(!Array.isArray(p)){throw"Ale.js: Wrong parameter type! In function setStates."}this.states=p};this.addStates=function(p){if(!this.permissions.addStates){throw"Ale.js: Operations are not allow! (no permission)"}if(!Array.isArray(p)){throw"Ale.js: Wrong parameter type! In function addStates."}if(!Array.isArray(this.states)){this.states=p}else{this.states=this.states.concat(p)}};this.removeStates=function(p){if(!this.permissions.removeStates){throw"Ale.js: Operations are not allow! (no permission)"}if(typeof p!=="number"){p=1}if(!Array.isArray(this.states)||this.states[this.states.length-p]===undefined||this.nowState>=this.states.length-p){return false}this.states.splice(this.states.length-p,p);return true};this.statesLength=function(){if(Array.isArray(this.states)){return this.states.length}};this.changeData=function(r,s){if(!this.permissions.changeData){throw"Ale.js: Operations are not allow! (no permission)"}if(typeof r==="object"){for(var q in r){this.data[q]=r[q]}if(typeof this.templateFn==="function"){this.template=b(this.templateFn,this.data)()}if(typeof this.statesFn==="function"){this.states=b(this.statesFn,this.data)();this.nowState=0}if(typeof this.eventsFn==="function"){this.events=b(this.eventsFn,this.data)()}if(Array.isArray(this.states)&&this.states.length>0){if(typeof this.life.Rendering==="function"){b(this.life.Rendering,this)()}var p=c(this.template,this.states[0]);for(var q=0;q<this.el.length;q++){this.el[q].innerHTML=p}}else{if(typeof this.life.Rendering==="function"){b(this.life.Rendering,this)()}for(var q=0;q<this.el.length;q++){this.el[q].innerHTML=this.template}}}else{this.data[r]=s;if(typeof this.templateFn==="function"){this.template=b(this.templateFn,this.data)()}if(typeof this.statesFn==="function"){this.states=b(this.statesFn,this.data)();this.nowState=0}if(typeof this.eventsFn==="function"){this.events=b(this.eventsFn,this.data)()}if(Array.isArray(this.states)&&this.states.length>0){var p=c(this.template,this.states[0]);if(typeof this.life.Rendering==="function"){b(this.life.Rendering,this)()}for(var q=0;q<this.el.length;q++){this.el[q].innerHTML=p}}else{if(typeof this.life.Rendering==="function"){b(this.life.Rendering,this)()}for(var q=0;q<this.el.length;q++){this.el[q].innerHTML=this.template}}}};this.destroy=function(){for(var p=0;p<this.el.length;p++){this.el[p].innerHTML=""}var q=this.life.Destroy;if(typeof this.life.Unmounting==="function"){b(this.life.Unmounting,this)()}for(var p in this){this[p]=undefined}if(typeof q==="function"){q()}};if(typeof this.life.Rendering==="function"){b(this.life.Rendering,this)()}var k,o;if(Array.isArray(this.states)){var l=c(this.template,this.states[this.defaultState]);if(typeof this.events==="object"){for(var n=0;n<this.el.length;n++){k=this.el[n];k.innerHTML=l;for(var j in this.events){this.el[n]["on"+j]=this.events[j]}}}else{for(var n=0;n<this.el.length;n++){k=this.el[n];k.innerHTML=l}}}else{if(typeof this.events==="object"){for(var n=0;n<this.el.length;n++){k=this.el[n];k.innerHTML=this.template;for(var j in this.events){k["on"+j]=this.events[j]}}}else{for(var n=0;n<this.el.length;n++){k=this.el[n];k.innerHTML=this.template}}}if(typeof this.life.Mounting==="function"){b(this.life.Mounting,this)()}}d.prototype.permissionsList=["changeState","nextStates","addStates","removeStates","setStates","backStates","changeData"];function a(j,o){var k=j.children,m,l,t,s,p;for(var n=0;n<k.length;n++){if(k[n].getAttribute("a-for")!==null){l=k[n].getAttribute("a-for").split("in")[1].trim().split("."),t=o,s=k[n].innerHTML,p=i.createElement(k[n].tagName.toLowerCase());for(var r=0;r<l.length;r++){t=t[l[r]]}for(var q=0;q<t.length;q++){m={};m[k[n].getAttribute("a-for").split("in")[0].trim()]=t[q];thisNowEl=i.createElement(k[n].tagName.toLowerCase());thisNowEl.innerHTML=c(s,m);thisNowEl=a(thisNowEl,t[q]);p.innerHTML+="<"+k[n].tagName.toLowerCase()+">"+thisNowEl.innerHTML+"</"+k[n].tagName.toLowerCase()+">"}j.innerHTML=p.innerHTML}else{if(k[n].children.length>0){k[n]=a(k[n],o)}}}return j}function b(l,j){function k(n){j._super=this;var m=arguments.length;return m?m>1?l.apply(j,arguments):l.call(j,n):l.call(j)}k._length=l.length;return k}function e(l){if(l===null){return null}if(typeof l!=="object"){return l}if(l.constructor===Date){return new Date(l)}if(l.constructor===RegExp){return new RegExp(l)}var j=new l.constructor();for(var k in l){if(l.hasOwnProperty(k)){var m=l[k];j[k]=typeof m==="object"?arguments.callee(m):m}}return j}function c(p,n){var m,k,j,l;p=p.replace(/\n/g,"").replace(/\r/g,""),m=p.match(/(?<=\{\{).*?(?=\}\})/g);if(m===null){return p}for(var o=0;o<m.length;o++){j=m[o];if(m[o].substr(0,2)==="=!"){m[o]=m[o].substr(2);m[o]=m[o].trim();for(var r in n){m[o]=h(r,n[r],m[o])}try{m[o]=new Function("return "+m[o])()}catch(q){m[o]="{{="+m[o]+"}}"}if(typeof m[o]==="object"&&!Array.isArray(m[o])){m[o]=JSON.stringify(m[o])}m[o]=m[o].replace(/</g,"&lt;").replace(/>/g,"&gt;");j=j.replace(/\\/g,"\\\\").replace(/\?/,"\\?").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/\*/g,"\\*").replace(/\+/g,"\\+").replace(/\-/g,"\\-").replace(/\//g,"\\/").replace(/\$/g,"\\$").replace(/\[/g,"\\[").replace(/\]/g,"\\]");k=new RegExp("{{"+j+"}}","g");p=p.replace(k,m[o])}else{if(m[o].substr(0,1)==="="){m[o]=m[o].substr(1);m[o]=m[o].trim();for(var r in n){m[o]=h(r,n[r],m[o])
}try{m[o]=new Function("return "+m[o])()}catch(q){m[o]="{{="+m[o]+"}}"}if(typeof m[o]==="object"&&!Array.isArray(m[o])){m[o]=JSON.stringify(m[o])}j=j.replace(/\\/g,"\\\\").replace(/\?/,"\\?").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/\*/g,"\\*").replace(/\+/g,"\\+").replace(/\-/g,"\\-").replace(/\//g,"\\/").replace(/\$/g,"\\$").replace(/\[/g,"\\[").replace(/\]/g,"\\]");k=new RegExp("{{"+j+"}}","g");p=p.replace(k,m[o])}else{m[o]=m[o].trim();for(var r in n){m[o]=h(r,n[r],m[o])}new Function(m[o])();j=j.replace(/\\/g,"\\\\").replace(/\?/,"\\?").replace(/\(/g,"\\(").replace(/\)/g,"\\)").replace(/\*/g,"\\*").replace(/\+/g,"\\+").replace(/\-/g,"\\-").replace(/\//g,"\\/").replace(/\$/g,"\\$").replace(/\[/g,"\\[").replace(/\]/g,"\\]");k=new RegExp("{{"+j+"}}","g");p=p.replace(k,"")}}}return p}function h(j,m,k){var l=new RegExp("\\$"+j+"\\$","g");if(typeof m==="string"){m=m.replace(/\"/g,'\\"');k=k.replace(l,'"'+m+'"')}else{if(typeof m==="object"&&!Array.isArray(m)){k=k.replace(l,JSON.stringify(m))}else{if(Array.isArray(m)){compileArrStr='"[';for(var n=0;n<m.length;n++){compileArrStr+='\\"'+m[n].replace(/\"/g,'\\"')+'\\",'}compileArrStr=compileArrStr.substr(0,compileArrStr.length-1);compileArrStr+=']"';k=k.replace(l,compileArrStr)}else{if(typeof m==="function"){m=m(),k=h(j,m,k)}else{m=String(m).replace(/\"/g,'\\"');k=k.replace(l,'"'+m+'"')}}}}return k}})(window,document);
